<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= page.title %> | <%= config.title %></title>
    
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Noto+Sans+SC:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <%- css('css/category.css') %> 
</head>
<body style="overflow-y: scroll; background: var(--bg-gray); padding-bottom: 50px;">
    
    <% 
      // === 容错检查：确保文章有分类数据 ===
      // 检查 page.categories 和 page.categories.data 是否存在，并确认有内容。
      const hasCategories = page.categories && page.categories.data && page.categories.data.length > 0;
      const firstCategory = hasCategories ? page.categories.data[0] : null; 
    %>
    
    <% if (firstCategory) { %>
      <a href="<%- url_for('/categories/' + firstCategory.slug + '/') %>" class="back-btn-post"><i class="fa-solid fa-arrow-left"></i> BACK TO <%= firstCategory.name.toUpperCase() %></a>
    <% } %>

    <main class="container">
      <article class="article-body" style="background: white; padding: 50px; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.1);">
          
          <h1 style="font-size: 2.5rem; margin-bottom: 10px; color: var(--text-main);"><%= page.title %></h1>
          
          <p style="color: #999; font-size: 0.9rem; margin-bottom: 40px;">
              <i class="fa-regular fa-calendar"></i> <%= date(page.date, 'YYYY-MM-DD') %> 
              · <%= firstCategory ? firstCategory.name + ' 分区' : '无分类' %>
          </p>
          
          <hr>
          
          <section class="post-content">
              <%- page.content %>
          </section>
          
          <div class="post-nav" style="margin-top: 50px; padding-top: 30px; border-top: 1px solid #eee; display: flex; justify-content: space-between;">
              
              <div class="nav-item prev-nav" style="max-width: 45%;">
                  <% if (page.prev) { %>
                      <a href="<%- url_for(page.prev.path) %>" class="nav-link prev-link" style="color: var(--primary); font-weight: 700; text-decoration: none;">
                          <i class="fa-solid fa-arrow-left"></i> 上一篇: <%= page.prev.title %>
                      </a>
                  <% } else { %>
                      <span style="display: block;">&nbsp;</span>
                  <% } %>
              </div>
              
              <div class="nav-item next-nav" style="max-width: 45%;">
                  <% if (page.next) { %>
                      <a href="<%- url_for(page.next.path) %>" class="nav-link next-link" style="color: var(--primary); font-weight: 700; text-decoration: none; text-align: right; display: block;">
                          下一篇: <%= page.next.title %> <i class="fa-solid fa-arrow-right"></i>
                      </a>
                  <% } else { %>
                      <span style="display: block;">&nbsp;</span>
                  <% } %>
              </div>

          </div>
          </article>
    </main>
</body>
</html>